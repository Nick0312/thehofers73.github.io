<!DOCTYPE html>
	<html>
	  <head>
	    <meta charset = "utf-8">
    	<style>
    	  * { padding: 0; margin: 0;}
    	  p {text-align: center; font-family:"Trebuchet MS", Helvetica, sans-serif; font-size: 30;}
    	  canvas {background: #ede; display: block; margin: 0 auto;}
    	</style>
	  </head>
  
  	<body>
  	  <br>  <p>Use the arrow keys to navigate!</p> <br> 
	    <canvas id = "gameCanvas" width = "700" height = "350"></canvas>
			<br>  <p>Win by beating Level 30. Each level will increase in difficulty systematically.</p>	<br>
			<p>To change the overall difficulty, press the buttons below.</p> <br>
			<button id="EasyButton">Easy</button> <button id="MediumButton">Medium</button> <button id="HardButton">Hard</button>
	    <script>
      	// create canvas
      	var canvas = document.getElementById("gameCanvas");
      	var ctx = canvas.getContext("2d");
				
				// difficulty buttons
				var easy = document.getElementById("EasyButton");
				var medium = document.getElementById("MediumButton");
				var hard = document.getElementById("HardButton");
				
				easy.onclick = function() {
					userBall.difficulty = 1.3;
				}
				medium.onclick = function() {
					userBall.difficulty = 1.5;
				}
				hard.onclick = function() {
					userBall.difficulty = 1.7;
				}
      	
      	// timer
        var start = Date.now();
      	
      	// selection of html colors
      	var colors = ["lime","red","aqua","purple","yellow","green","navy","olive"]
      	
      	// init ball
      	var userBall = {x: 450,
          	            y: 300,
          	            r: 15,
          	            termVel: 10,
          	            ax: 0.3,
          	            ay: 0.3,
          	            dx: 0,
          	            dy: 0,
          	            move: function() {
          	              if (rightKey == true) {
          	                if (leftKey == false) {
          	                  if (this.dx <= this.termVel - this.ax) {
          	                    this.dx = Math.round(100*(this.dx + this.ax))/100;
          	                  }
          	                }
          	              }
          	              if (leftKey == true) {
          	                if (rightKey == false) {
          	                  if (this.dx >= -this.termVel + this.ax) {
          	                    this.dx = Math.round(100*(this.dx - this.ax))/100;
          	                  }
          	                }
          	              }
          	              if (upKey == true) {
          	                if (downKey == false) {
          	                  if (this.dy >= -this.termVel + this.dy) {
          	                    this.dy = Math.round(100*(this.dy - this.ay))/100;
          	                  }
          	                }
          	              }
          	              if (downKey == true) {
          	                if (upKey == false) {
          	                  if (this.dy <= this.termVel - this.dy) {
          	                    this.dy = Math.round(100*(this.dy + this.ay))/100;
          	                  }
          	                }
          	              }
          	              
          	              
          	              if (rightKey == false && leftKey == false) {
          	                if (this.dx > 0) {
          	                  this.dx = Math.round(100*(this.dx - this.ax))/100;
          	                }
          	                if (this.dx < 0) {
          	                  this.dx = Math.round(100*(this.dx + this.ax))/100;
          	                }
          	                
          	              }
          	              
          	              if (upKey == false && downKey == false) {
          	                if (this.dy > 0) {
          	                  this.dy = Math.round(100*(this.dy - this.ay))/100;
          	                }
          	                if (this.dy < 0) {
          	                  this.dy = Math.round(100*(this.dy + this.ay))/100;
          	                }
          	              }
          	              this.x += Math.round(100*this.dx)/100;
          	              this.y += Math.round(100*this.dy)/100;
          	            },
          	            create: function() {
          	              ctx.beginPath();
            	            ctx.arc(this.x, this.y, this.r, 0, Math.PI*2, false);
            	            ctx.fillStyle = "#111111";
                        	ctx.fill();
                        	ctx.closePath();
          	            },
          	            collisionDetect: function() {
          	              if (this.x > canvas.width - this.r) {
            	              this.x = canvas.width - this.r;
            	              this.dx = 0;
            	            }
                        	if (this.y > canvas.height - this.r) {
                        	  this.y = canvas.height - this.r;
                        	  this.dy = 0;
                        	}
                        	if (this.x < this.r) {
                        	  this.x = this.r;
                        	  this.dx = 0;
                        	}
                        	if (this.y < this.r) {
                        	  this.y = this.r;
                        	  this.dy = 0;
                        	}
          	            },
      	              score: 0,
      	              level: 1,
      	              display: function() {
      	                ctx.fillStyle = "black";
      	                ctx.font = "20px Verdana";
      	                ctx.textAlign = "left";
      	                ctx.fillText("Level: " + this.level, 0, canvas.height - 35);
      	                ctx.fillText("Score: " + this.score, 0, canvas.height - 10);
											
			      						ctx.font = "15px Lucida Console";
												ctx.textAlign = "left";
												ctx.fillText((initTime - (Math.floor((Date.now() - start)/1000))) + " seconds left...", 0, 10);
												if (userBall.score < initReqScore) {	
													ctx.fillText((initReqScore - this.score) + " points needed", canvas.width*1/5, 10);
												}, 
											difficulty: 1.5;
      	              }
      	};
      
      	// user control of Ball
      	var upKey = false;
      	var downKey = false;
      	var leftKey = false;
      	var rightKey = false;
      	
      	// event listeners for keys
      	document.addEventListener("keydown",keyHandlerYes, false);
      	document.addEventListener("keyup",keyHandlerNo, false);

      	// event listener functions
      	function keyHandlerYes(e) {
        	if (e.keyCode == 37) {
          	leftKey = true;
        	} else if (e.keyCode == 38) {
          	upKey = true;
        	} else if (e.keyCode == 39) {
        	  rightKey = true;
        	} else if (e.keyCode == 40) {
          	downKey = true;
        	}
      	
      	}
      	
      	function keyHandlerNo(e) {
        	if (e.keyCode == 37) {
        	  leftKey = false;
        	} else if (e.keyCode == 38) {
        	  upKey = false;
        	} else if (e.keyCode == 39) {
        	  rightKey = false;
        	} else if (e.keyCode == 40) {
          	downKey = false;
        	}
        	
      	}
        
        // spawn food
        function food(x,y,r,c) {
                    this.x = x;
                    this.y = y;
                    this.radius = r;
                    this.color = c;
                    this.selfDestruct = function() {
                      var x;
                      for (x in this) {
                        this[x] = null;
                      }
                    };
                    this.draw = function() {
                      ctx.beginPath();
                      ctx.arc(this.x, this.y, this.radius, 0, Math.PI*2, false);
            	        ctx.fillStyle = c;
                    	ctx.fill();
                    	ctx.closePath();
                    };
                    this.eaten = function() {
                      if (Math.sqrt(Math.pow(this.x - userBall.x, 2) + Math.pow(this.y - userBall.y, 2)) < this.radius + userBall.r) {
                      	return true;
                      } else {
                       return false;
                      }
          	         }
        };
        
        var foodList = [];
        var maxFood = 10;
        
        for (var i = 0; i < maxFood; i++) {
          var a = new food(Math.floor(Math.random()*canvas.width),Math.floor(Math.random()*canvas.height),Math.floor(Math.random()*5) + 5, colors[Math.floor(Math.random()*(colors.length - 1))]);
          foodList.push(a);
        }
        
        // generate levels
        var initReqScore = 50;
				var initTime = 20;
				
				var levelComplete = false;
		  	var gameOver = false;
				
        function newLevel() {
          for (var i = 1; i < 31; i++) {
            if (userBall.level == i) {
							
              if ((Math.round((Date.now() - start)/1000) <= initTime  && userBall.score >= initReqScore)) {
                start = Date.now();
                
								initTime += 2*i;
                initReqScore = Math.floor(initReqScore*userBall.difficulty) + 5*i;
                
                userBall.level++;
                if (i % 3 == 0) {userBall.radius--};
                if (i % 5 == 0) {userBall.termVel++}
                
                if (i % 2 == 0) {
                  canvas.height += 10;
                  canvas.width = 2*canvas.height
								}
								
                
                maxFood++;
                break;
              } else if (Math.round((Date.now() - start)/1000) > initTime) {gameOver = true;}
            } else {continue;}
          }
        }
        
      	// function to loop in the canvas
      	function drawLoop() {
      	  
        	ctx.clearRect(0,0,canvas.width,canvas.height);
          
					var elapsedTime = Math.round((Date.now() - start)/1000);
          
          for (var i = 0; i < foodList.length; i++) {
            if ((foodList[i].x < (userBall.x - 2*userBall.r) || foodList[i].x > (userBall.x + 2*userBall.r)) && (foodList[i].y < (userBall.y - 2*userBall.r) || foodList[i].y > userBall.y + 2*userBall.r)) {continue;}
            if (foodList[i].eaten()) {
              userBall.score += Math.round(Math.pow(foodList[i].radius,1/3));
              
              foodList[i].selfDestruct();
              foodList.splice(i,1);
              
              }
          }
          
          
          if (foodList.length < maxFood) {
            if (0.03 > Math.random()) {
              foodList[foodList.length] = new food(Math.floor(Math.random()*(canvas.width - 15)),Math.floor(Math.random()*(canvas.height - 15)),Math.floor(Math.random()*5 + 5), colors[Math.floor(Math.random()*(colors.length - 1))]);
            }
          }
          
          for (var a = 0; a < foodList.length; a++) {
            foodList[a].draw();
          }
          
          
          
          userBall.move();
          userBall.collisionDetect();
          userBall.create();
          userBall.display();
          
          newLevel();
          
          if (userBall.level == 30){
            ctx.clearRect(0,0,canvas.width,canvas.height);
            ctx.fillStyle = "black";
      	    ctx.font = "40px Helvetica";
      	    ctx.textAlign = "center";
      	    ctx.fillText("You won!", canvas.width/2, canvas.height/2 - 100);
      	    ctx.fillText("Score: " + userBall.score, canvas.width/2, canvas.height/2);
          } else if (gameOver == true) {
						
							window.alert("Sorry, you ran out of time. Reload to try again.");
							
					} else {
            requestAnimationFrame(drawLoop);
					}
          
        }
        
        drawLoop();
      	
      	

	</script>
	</body>
	</html>
